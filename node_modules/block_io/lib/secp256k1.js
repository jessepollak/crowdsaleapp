var ECKey = require('./key');
var Bitcoin = require('bitcoinjs-lib');

try {
  var signer = require('secp256k1');
} catch (e) {
  signer = e;
}

module.exports = {
  signer: signer,
  register: function () {
    if (!(signer instanceof Error)) {
      ECKey.prototype._signPureJs = ECKey.prototype.sign;

      ECKey.prototype.sign = function (hash) {
        var der = signer.sign(hash, this.d.toBuffer());
        return Bitcoin.ECSignature.fromDER(der);
      }
    }
  }
};
